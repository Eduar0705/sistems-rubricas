    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../img/logoiujo.jpg" alt="logo IUJO" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" style="max-width: 200px; text-align: center;">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <a href="/student" class="nav-item <%= currentPage === 'student' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-chart-line"></i>
                <span>Panel Principal</span>
            </a>
            <a href="/students/calificaciones" class="nav-item <%= currentPage === 'calificaciones' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-graduation-cap"></i>
                <span>Mis Calificaciones</span>
            </a>
            <a href="/student/evaluaciones" class="nav-item <%= currentPage === 'evaluaciones' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-clipboard-check"></i>
                <span>Mis Evaluaciones</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name"><%= datos.username %></div>
                    <div class="user-role">Estudiante</div>
                </div>
            </div>
        </div>
    </aside>
    <script>
    (function (win, doc) {
        'use strict';

        function ready(fn) {
            if (doc.readyState === 'loading') {
                doc.addEventListener('DOMContentLoaded', fn);
            } else {
                fn();
            }
        }

        function normalizePath(p) {
            if (!p) return '/';
            try {
                var u = new URL(p, location.origin);
                p = u.pathname;
            } catch (e) {
                // leave as-is (relative path)
            }
            // remove trailing slashes except root
            return String(p).replace(/\/+$/, '') || '/';
        }

        ready(function () {
            // currentPageHighlight: define only if missing to avoid overriding other scripts
            if (typeof win.currentPageHighlight !== 'function') {
                win.currentPageHighlight = function (page) {
                    var navItems = Array.prototype.slice.call(doc.querySelectorAll('.nav-item'));
                    var target = normalizePath(page || win.location.pathname || '/');

            // compute best match: prefer exact match, then parent, then child, then partial
            var best = { score: -1, node: null };
            navItems.forEach(function (item) {
                item.classList.remove('active');
                try {
                    var href = item.getAttribute('href') || '';
                    var hpath = normalizePath(href);
                    // treat match if target starts with hpath or viceversa (covers root/parent cases)
                    var match = (hpath === '/' && target === '/') ||
                                (hpath !== '/' && (target === hpath || target.indexOf(hpath + '/') === 0 || hpath.indexOf(target + '/') === 0 || hpath.indexOf(target) === 0));
                    if (match) {
                        var score = hpath.length;
                        if (target === hpath) score += 1000; // exact match
                        else if (target.indexOf(hpath + '/') === 0) score += 100; // parent
                        else if (hpath.indexOf(target + '/') === 0) score += 10; // child
                        else if (hpath.indexOf(target) === 0) score += 1; // starts with
                        if (score > best.score) {
                            best.score = score;
                            best.node = item;
                        }
                    }
                } catch (e) {
                    // ignore invalid attributes
                }
            });
                    if (best.node) best.node.classList.add('active');
                };
            }

            // initial highlight (safe call)
            try { win.currentPageHighlight(); } catch (e) { /* ignore */ }

            // Sidebar toggle logic removed as it is handled by home.js via the header button

            // Exit: define only if not already present. Provide robust logout (POST if possible, fallback to GET),
            // show confirmation dialog if Swal available, but do not override existing Exit implementation.
            if (typeof win.Exit !== 'function') {
                win.Exit = function () {
                    var doLogout = function () {
                        // try a POST logout (some servers expect POST), fallback to navigate to /logout
                        try {
                            fetch('/logout', {
                                method: 'POST',
                                credentials: 'same-origin',
                                headers: { 'Content-Type': 'application/json' }
                            }).then(function (res) {
                                // if server redirects, follow; otherwise go to a safe page
                                if (res && res.redirected) {
                                    win.location.href = res.url;
                                } else {
                                    // prefer server-provided location or fallback to /login or /logout
                                    win.location.href = '/logout';
                                }
                            }).catch(function () {
                                win.location.href = '/logout';
                            });
                        } catch (e) {
                            win.location.href = '/logout';
                        }
                    };

                    var confirmAndLogout = function () {
                        if (win.Swal && typeof win.Swal.fire === 'function') {
                            win.Swal.fire({
                                icon: 'warning',
                                title: 'Validación',
                                text: '¿Estás seguro que deseas cerrar sesión?',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Sí, cerrar sesión',
                                cancelButtonText: 'Cancelar'
                            }).then(function (result) {
                                if (result && result.isConfirmed) doLogout();
                            });
                        } else {
                            if (confirm('¿Estás seguro que deseas cerrar sesión?')) doLogout();
                        }
                    };

                    confirmAndLogout();
                };
            }

            // Also attach a safe click handler to any logout buttons that have data-action="logout"
            // without overriding existing handlers (idempotent)
            var logoutButtons = doc.querySelectorAll('[data-action="logout"]');
            Array.prototype.forEach.call(logoutButtons, function (btn) {
                if (btn.dataset._logoutBound !== '1') {
                    btn.addEventListener('click', function (e) {
                        e.preventDefault();
                        try { (win.Exit || function () { win.location.href = '/logout'; })(); } catch (ex) { win.location.href = '/logout'; }
                    });
                    btn.dataset._logoutBound = '1';
                }
            });
        });
    })(window, document);
    </script>
