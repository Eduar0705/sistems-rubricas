<!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Sistema de Rúbricas</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="/home" class="nav-item <%= currentPage === 'home' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-chart-line"></i>
                <span>Panel Principal</span>
            </a>
            <a href="/admin/rubricas" class="nav-item <%= currentPage === 'rubricas' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-table"></i>
                <span>Mis Rúbricas</span>
            </a>
            <a href="/admin/createrubricas" class="nav-item <%= currentPage === 'createrubricas' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-plus-circle"></i>
                <span>Crear Rúbrica</span>
            </a>
            <a href="/admin/evaluaciones" class="nav-item <%= currentPage === 'evaluaciones' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-clipboard-check"></i>
                <span>Evaluaciones</span>
            </a>
            <a href="/admin/permisos" class="nav-item <%= currentPage === 'permisos' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-user-plus"></i>
                <span>Permisos</span>
            </a>
            <a href="/admin/profesores" class="nav-item <%= currentPage === 'profesores' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Profesores</span>
            </a>
            <a href="/admin/reportes" class="nav-item <%= currentPage === 'reportes' ? 'active' : '' %>" data-external="true">
                <i class="fas fa-file-alt"></i>
                <span>Reportes</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name"><%= datos.username %></div>
                    <div class="user-role"><%= datos.id_rol === 1 ? 'Administrador' : 'Docente' %></div>
                </div>
            </div>
            <button class="header-btn" onclick="Exit()">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </aside>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // make callable from other scripts and robust against missing hrefs
            window.currentPageHighlight = function (page) {
                const navItems = document.querySelectorAll('.nav-item');
                const normalize = p => (p || '').replace(/\/+$/, '');
                const target = normalize(page || window.location.pathname || '/');
                navItems.forEach(item => {
                    item.classList.remove('active');
                    try {
                        const href = item.getAttribute('href') || '';
                        if (normalize(href).includes(target)) {
                            item.classList.add('active');
                        }
                    } catch (e) {
                        // ignore invalid attributes
                    }
                });
            };

            // initial highlight based on current path
            window.currentPageHighlight();

            // optional sidebar toggle behavior if present
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                });
            }

            // Función para confirmar la salida del programa con fallback si Swal no está disponible
            window.Exit = function () {
                const doLogout = () => { window.location.href = '/logout'; };

                if (window.Swal && typeof Swal.fire === 'function') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Validación',
                        text: '¿Estás seguro que deseas cerrar sesión?',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Sí, cerrar sesión',
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            doLogout();
                        }
                    });
                } else {
                    // fallback simple confirm dialog
                    if (confirm('¿Estás seguro que deseas cerrar sesión?')) {
                        doLogout();
                    }
                }
            };
        });
    </script>