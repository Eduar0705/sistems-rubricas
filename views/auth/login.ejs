<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar SesiÃ³n - Sistema de RÃºbricas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/login.css">
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="login-container">
        <!-- Logo y Header Superior -->
        <div class="login-left">
            <div class="login-branding">
                <img src="./img/logoiujo.jpg" alt="Logo IUJO" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <h1>Bienvenido a Sistema de Gestion de Rubricas! ðŸ‘‹</h1>
                <p class="brand-subtitle">Por favor, coloca tu usuario y contraseÃ±a</p>
            </div>
        </div>

        <!-- Formulario de Login -->
        <div class="login-right">
            <div class="login-card">
                <form id="loginForm" class="login-form" method="post" action="/verifLogin">
                    <% if (typeof sesionActiva != 'undefined' && sesionActiva) { %>
                        <input type="hidden" name="cedula" value="<%= cedula %>">
                        <input type="hidden" name="password" value="<%= password %>">
                        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                        <script>
                            Swal.fire({
                                icon: 'warning',
                                title: 'SesiÃ³n Activa Detectada',
                                html: `
                                    <p>Ya existe una sesiÃ³n activa para este usuario.</p>
                                    <p><strong>Tiempo restante:</strong> ~<%= tiempoRestante %> minuto(s)</p>
                                    <p>Â¿Deseas cerrar la sesiÃ³n anterior e iniciar una nueva?</p>
                                `,
                                showCancelButton: true,
                                confirmButtonText: 'SÃ­, cerrar sesiÃ³n anterior',
                                cancelButtonText: 'Cancelar',
                                confirmButtonColor: '#d33',
                                cancelButtonColor: '#3085d6',
                                allowOutsideClick: false
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    const form = document.getElementById('loginForm');
                                    const input = document.createElement('input');
                                    input.type = 'hidden';
                                    input.name = 'forzarCierre';
                                    input.value = 'true';
                                    form.appendChild(input);
                                    form.submit();
                                } else {
                                    window.location.href = '/login';
                                }
                            });
                        </script>
                    <% } else if (typeof mensaje != 'undefined' && mensaje) { %>
                        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                        <script>
                            Swal.fire({
                                icon: 'info',
                                title: 'InformaciÃ³n',
                                text: '<%= mensaje %>',
                                confirmButtonText: 'Aceptar'
                            });
                        </script>
                    <% } %>
                    
                    <div class="form-group">
                        <label for="cedula">
                            <i class="fas fa-id-card"></i>
                            Usuario
                        </label>
                        <input type="text" id="cedula" name="cedula" placeholder="12345678" required>
                    </div>

                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i>
                            ContraseÃ±a
                        </label>
                        <div class="password-input-wrapper">
                            <input type="password" id="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                            <button type="button" class="toggle-password" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-options">
                        <a href="/" class="forgot-password"><i class="fas fa-arrow-left"></i> Volver</a>
                        <a href="#" class="forgot-password">Â¿Olvidaste tu contraseÃ±a?</a>
                    </div>

                    <button type="submit" class="btn-login" id="loginBtn">
                        <span class="btn-text">Login</span>
                        <span class="btn-loader" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../js/login.js"></script>
</body>
</html>